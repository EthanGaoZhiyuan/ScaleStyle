apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Minikube-specific configuration
# Local development environment with minimal resource requirements

resources:
  - ../../base
  - inference-hpa.yaml

# Minikube-specific patches
patches:
  - path: ingress-minikube.yaml
  - path: resource-limits-small.yaml
  - path: init-job-fast.yaml

# Minikube uses hostPath for storage

# Image configuration for Minikube
# Replace 'your-dockerhub-username' with actual Docker Hub username
# Or use 'imagePullPolicy: Never' and build locally with: eval $(minikube docker-env)
images:
  - name: scalestyle-gateway
    newName: your-dockerhub-username/scalestyle-gateway
    newTag: latest
  - name: scalestyle-inference
    newName: your-dockerhub-username/scalestyle-inference
    newTag: latest
  - name: scalestyle-data-init
    newName: your-dockerhub-username/scalestyle-data-init
    newTag: latest

# Minikube-specific ConfigMap overrides
patches:
  - target:
      kind: ConfigMap
      name: scalestyle-config
    patch: |-
      - op: add
        path: /data/ENVIRONMENT
        value: minikube
      - op: replace
        path: /data/REDIS_HOST
        value: redis.scalestyle.svc.cluster.local
      - op: replace
        path: /data/MILVUS_HOST
        value: milvus.scalestyle.svc.cluster.local
      - op: replace
        path: /data/INFERENCE_BASE_URL
        value: http://inference.scalestyle.svc.cluster.local:8000

